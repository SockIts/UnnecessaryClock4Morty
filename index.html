<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Time Converter and Calendar</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      margin: 0;
      background-color: #f0f0f0;
      font-size: 16px;
      -webkit-font-smoothing: antialiased;
    }
    .main-container {
      display: flex;
      flex-direction: row;
      gap: 16px;
      width: 100%;
      max-width: 1000px;
      padding: 16px;
      box-sizing: border-box;
      justify-content: center;
    }
    .timer-container, .calendar-container {
      background-color: white;
      padding: 16px;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      text-align: center;
      width: 100%;
      max-width: 450px;
      box-sizing: border-box;
    }
    .time-box {
      margin: 16px 0;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .time-box .input-group {
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 100%;
      gap: 8px;
    }
    .time-box label {
      font-size: 1.1em;
      margin-bottom: 8px;
      font-weight: 600;
      color: #333;
    }
    .time-box select, .time-box input[type="time"], .calendar-container input, .calendar-container select, .calendar-container button {
      padding: 10px;
      font-size: 1em;
      width: 100%;
      max-width: 300px;
      border: 1px solid #ccc;
      border-radius: 8px;
      box-sizing: border-box;
      -webkit-appearance: none;
      -moz-appearance: none;
      appearance: none;
    }
    .time-box select, .calendar-container select {
      background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12"><path fill="%23333" d="M6 9L2 5h8z"/></svg>') no-repeat right 10px center;
      background-size: 12px;
    }
    .time-display {
      font-size: 1.2em;
      margin: 12px 0;
      font-weight: 600;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 6px;
      color: #333;
    }
    .minutes-until {
      font-size: 1em;
      color: #555;
      margin-top: 8px;
    }
    .header {
      font-size: 1.5em;
      font-weight: 700;
      margin: 16px 0;
      color: #333;
      text-align: center;
    }
    .calendar-container .input-group {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
      margin-bottom: 16px;
    }
    .calendar-container button {
      background-color: #4CAF50;
      color: white;
      border: none;
      cursor: pointer;
      padding: 12px;
      font-size: 1em;
      border-radius: 8px;
      width: 100%;
      max-width: 300px;
      transition: background-color 0.2s;
    }
    .calendar-container button:active {
      background-color: #45a049;
    }
    .event-list-container {
      display: flex;
      align-items: flex-start;
      gap: 8px;
      margin-top: 16px;
    }
    .event-list {
      text-align: left;
      font-size: 0.9em;
      max-height: 200px;
      overflow-y: auto;
      flex-grow: 1;
    }
    .event-list div {
      margin: 8px 0;
      padding: 8px;
      background-color: #f9f9f9;
      border-radius: 6px;
    }
    .delete-buttons {
      display: flex;
      flex-direction: column;
      gap: 20px;
      margin-top: 14px;
    }
    .delete-button {
      background-color: #ff0000;
      color: white;
      border: none;
      width: 18px;
      height: 18px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.7em;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0;
      transition: background-color 0.2s;
    }
    .delete-button:active {
      background-color: #cc0000;
    }
    @media (max-width: 768px) {
      .main-container {
        flex-direction: column;
        padding: 12px;
        max-width: 500px;
      }
      .header {
        font-size: 1.3em;
      }
      .timer-container, .calendar-container {
        padding: 12px;
        max-width: 100%;
      }
      .time-box select, .time-box input[type="time"], .calendar-container input, .calendar-container select, .calendar-container button {
        font-size: 0.9em;
        padding: 8px;
      }
      .time-display {
        font-size: 1em;
      }
      .minutes-until {
        font-size: 0.9em;
      }
      .event-list-container {
        flex-direction: column;
        align-items: stretch;
      }
      .delete-buttons {
        flex-direction: row;
        flex-wrap: wrap;
        gap: 4px;
        margin-top: 4px;
      }
    }
  </style>
</head>
<body>
  <div class="header">Minutes Countdown and Calendar for Morty</div>
  <div class="main-container">
    <div class="timer-container">
      <div class="time-box">
        <label for="current-time">Current Time:</label>
        <div id="current-time" class="time-display"></div>
      </div>
      <div class="time-box">
        <label for="target-timezone">Target Time:</label>
        <div class="input-group">
          <select id="target-timezone">
            <option value="Africa/Johannesburg">Morty (UTC+2)</option>
            <option value="America/La_Paz">Derp (UTC-4)</option>
            <option value="Europe/Moscow">John (UTC+3)</option>
            <option value="America/Chicago">AZ (Central)</option>
            <option value="America/Denver">HP (Mountain)</option>
            <option value="America/Los_Angeles" selected>Socks (PST)</option>
          </select>
          <input type="time" id="target-time-input" value="14:30">
          <select id="target-day">
            <option value="0">Sunday</option>
            <option value="1">Monday</option>
            <option value="2">Tuesday</option>
            <option value="3" selected>Wednesday</option>
            <option value="4">Thursday</option>
            <option value="5">Friday</option>
            <option value="6">Saturday</option>
          </select>
        </div>
        <div id="target-time" class="time-display"></div>
      </div>
      <div id="minutes-until" class="minutes-until"></div>
    </div>
    <div class="calendar-container">
      <div class="time-box">
        <label for="calendar">Add Event:</label>
        <div class="input-group">
          <input type="text" id="event-name" placeholder="Event Name">
          <input type="date" id="event-date">
          <input type="time" id="event-time">
          <select id="event-timezone">
            <option value="Africa/Johannesburg">Morty (UTC+2)</option>
            <option value="America/La_Paz">Derp (UTC-4)</option>
            <option value="Europe/Moscow">John (UTC+3)</option>
            <option value="America/Chicago">AZ (Central)</option>
            <option value="America/Denver">HP (Mountain)</option>
            <option value="America/Los_Angeles" selected>Socks (PST)</option>
          </select>
          <button id="submit-event">Add Event</button>
        </div>
        <div class="event-list-container">
          <div id="event-list" class="event-list"></div>
          <div id="delete-buttons" class="delete-buttons"></div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Available timezones
    const timezones = [
      { id: 'Africa/Johannesburg', display: 'Morty (UTC+2)' },
      { id: 'America/La_Paz', display: 'Derp (UTC-4)' },
      { id: 'Europe/Moscow', display: 'John (UTC+3)' },
      { id: 'America/Chicago', display: 'AZ (Central)' },
      { id: 'America/Denver', display: 'HP (Mountain)' },
      { id: 'America/Los_Angeles', display: 'Socks (PST)' }
    ];

    // Day map
    const dayMap = {
      'Sunday': 0,
      'Monday': 1,
      'Tuesday': 2,
      'Wednesday': 3,
      'Thursday': 4,
      'Friday': 5,
      'Saturday': 6
    };

    // Function to get date parts
    function formatDateParts(date, timezone) {
      const formatter = new Intl.DateTimeFormat('en-US', {
        timeZone: timezone,
        year: 'numeric',
        month: '2-digit',
        day: '2-digit',
        hour: '2-digit',
        minute: '2-digit',
        second: '2-digit',
        hour12: false
      });
      const parts = formatter.formatToParts(date);
      const map = {};
      parts.forEach(p => {
        if (p.type !== 'literal') map[p.type] = p.value;
      });
      return map;
    }

    // Function to get timezone offset in minutes
    function getTimezoneOffset(timezone, dateUTC = new Date()) {
      const utcParts = formatDateParts(dateUTC, 'UTC');
      const tzParts = formatDateParts(dateUTC, timezone);
      const utcMs = Date.UTC(utcParts.year, utcParts.month - 1, utcParts.day, utcParts.hour, utcParts.minute, utcParts.second);
      const tzMs = Date.UTC(tzParts.year, tzParts.month - 1, tzParts.day, tzParts.hour, tzParts.minute, tzParts.second);
      return (tzMs - utcMs) / 60000;
    }

    // Function to format time with day of the week
    function formatTime(date, timezone) {
      return date.toLocaleString('en-US', {
        timeZone: timezone,
        weekday: 'long',
        hour: 'numeric',
        minute: '2-digit',
        hour12: true
      });
    }

    // Function to parse time input (HH:MM) to hours and minutes
    function parseTimeInput(timeString) {
      const [hours, minutes] = timeString.split(':').map(Number);
      return { hours, minutes };
    }

    // Function to update the time displays
    function updateTimes() {
      const targetTimezone = document.getElementById('target-timezone').value;
      const targetTimeInput = document.getElementById('target-time-input').value;
      const targetDay = parseInt(document.getElementById('target-day').value);

      // Get current time for all timezones
      const now = new Date();
      const currentTimeDisplay = timezones.map(timezone => {
        const time = formatTime(now, timezone.id);
        return `<div>${timezone.display}: ${time}</div>`;
      }).join('');
      document.getElementById('current-time').textContent = '';
      document.getElementById('current-time').innerHTML = currentTimeDisplay;

      // Parse target time input
      const { hours, minutes } = parseTimeInput(targetTimeInput);

      // Get current parts and weekday in target timezone
      const currentParts = formatDateParts(now, targetTimezone);
      const currentWeekdayName = new Intl.DateTimeFormat('en-US', { timeZone: targetTimezone, weekday: 'long' }).format(now);
      const currentDay = dayMap[currentWeekdayName];

      // Calculate days until target
      let daysUntilTarget = (targetDay - currentDay + 7) % 7;
      const currentHour = parseInt(currentParts.hour);
      const currentMinute = parseInt(currentParts.minute);
      if (daysUntilTarget === 0 && (currentHour > hours || (currentHour === hours && currentMinute >= minutes))) {
        daysUntilTarget = 7;
      }

      // Get approximate offset
      const approxOffset = getTimezoneOffset(targetTimezone, now);

      // Calculate target fake ms (local parts as UTC)
      const currentYear = parseInt(currentParts.year);
      const currentMonth = parseInt(currentParts.month);
      const currentDayOfMonth = parseInt(currentParts.day);
      const targetFakeMs = Date.UTC(currentYear, currentMonth - 1, currentDayOfMonth + daysUntilTarget, hours, minutes, 0);

      // Approximate target UTC
      const approxTargetUTCms = targetFakeMs - approxOffset * 60000;

      // Get exact offset at approximate target
      const exactOffset = getTimezoneOffset(targetTimezone, new Date(approxTargetUTCms));

      // Final target UTC ms
      const targetUTCms = targetFakeMs - exactOffset * 60000;
      const targetDate = new Date(targetUTCms);

      // Format target time with day of the week
      const targetTime = formatTime(targetDate, targetTimezone);
      document.getElementById('target-time').textContent = targetTime;

      // Calculate minutes until target time
      const minutesUntil = Math.round((targetUTCms - now.getTime()) / 60000);
      document.getElementById('minutes-until').textContent = `${minutesUntil} minutes until target time`;
    }

    // Event handling for calendar
    let events = JSON.parse(localStorage.getItem('events')) || [];

    function addEvent() {
      const eventName = document.getElementById('event-name').value;
      const eventDate = document.getElementById('event-date').value;
      const eventTime = document.getElementById('event-time').value;
      const eventTimezone = document.getElementById('event-timezone').value;

      if (eventName && eventDate && eventTime && eventTimezone) {
        const timezoneDisplay = timezones.find(tz => tz.id === eventTimezone).display;
        events.push({ name: eventName, date: eventDate, time: eventTime, timezone: timezoneDisplay });
        localStorage.setItem('events', JSON.stringify(events));
        document.getElementById('event-name').value = '';
        document.getElementById('event-date').value = '';
        document.getElementById('event-time').value = '';
        updateEventList();
      } else {
        alert('Please fill in all event fields.');
      }
    }

    function deleteEvent(index) {
      events.splice(index, 1);
      localStorage.setItem('events', JSON.stringify(events));
      updateEventList();
    }

    function updateEventList() {
      const eventList = document.getElementById('event-list');
      const deleteButtons = document.getElementById('delete-buttons');
      eventList.innerHTML = events.map(event => 
        `<div>${event.name} - ${event.date} at ${event.time} (${event.timezone})</div>`
      ).join('');
      deleteButtons.innerHTML = events.map((_, index) => 
        `<button class="delete-button" onclick="deleteEvent(${index})">X</button>`
      ).join('');
    }

    // Initialize event list on page load
    updateEventList();

    // Update times initially and every second
    updateTimes();
    setInterval(updateTimes, 1000);

    // Update times when timezone, target time, or target day changes
    document.getElementById('target-timezone').addEventListener('change', updateTimes);
    document.getElementById('target-time-input').addEventListener('change', updateTimes);
    document.getElementById('target-day').addEventListener('change', updateTimes);

    // Add event listener for event submission
    document.getElementById('submit-event').addEventListener('click', addEvent);
  </script>
</body>
</html>
